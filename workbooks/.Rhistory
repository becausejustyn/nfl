pbp %>%
filter(down == 4) %>%
count(punt_attempt)
pbp %>%
filter(down == 4, is.na(field_goal_attempt)
)
pbp %>%
filter(down == 4, is.na(field_goal_attempt)) %>% select(desc)
pbp %>%
filter(down == 4) %>%
count(pass_attempt)
pbp %>%
filter(down == 4) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type %in% c("field_goal", "pass", "punt", "run")) %>%
count(play_type)
pbp %>%
filter(down == 4) %>%
count(pass_attempt)
pbp %>%
filter(down == 4, play_type %in% c("field_goal", "pass", "punt", "run"), !is.na(pass_attempt)) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type %in% c("field_goal", "pass", "punt", "run"), !is.na(pass_attempt)) %>%
count(rush_attempt)
pbp %>%
filter(down == 4, play_type %in% c("field_goal", "pass", "punt", "run")) %>%
summarise(across(everything(),
~sum(is.na(.))))
pbp %>%
filter(down == 4, play_type %in% c("field_goal", "pass", "punt", "run")) %>%
summarise(across(everything(),
~sum(is.na(.))))
filter(pbp, down == 4) %>% count(special_teams_play)
pbp %>%
filter(down == 4) %>%
summarise(
pass = sum(pass, na.rm = TRUE),
pass_attempt = sum(pass_attempt, na.rm = TRUE),
rush = sum(rush, na.rm = TRUE),
rush_attempt = sum(rush_attempt, na.rm = TRUE),
field_goal_attempt = sum(field_goal_attempt, na.rm = TRUE),
punt_attempt = sum(punt_attempt, na.rm = TRUE)
)
filter(pbp, down == 4) %>% count(pass)
pbp %>%
filter(down == 4, pass == 1)
pbp %>%
filter(down == 4) %>%
summarise(
pass = sum(pass, na.rm = TRUE),
pass_attempt = sum(pass_attempt, na.rm = TRUE),
rush = sum(rush, na.rm = TRUE),
rush_attempt = sum(rush_attempt, na.rm = TRUE),
field_goal_attempt = sum(field_goal_attempt, na.rm = TRUE),
punt_attempt = sum(punt_attempt, na.rm = TRUE)
)
select(pbp, contains('fg')) %>% names()
select(pbp, contains('goal')) %>% names()
select(pbp, contains('punt')) %>% names()
pbp %>%
filter(down == 4) %>%
summarise(
pass = sum(pass, na.rm = TRUE),
rush = sum(rush, na.rm = TRUE),
field_goal_attempt = sum(field_goal_attempt, na.rm = TRUE),
punt_attempt = sum(punt_attempt, na.rm = TRUE)
)
df_wide_season
df_wide_season %>%
ggplot(aes(
x = season,
y = go_for_it_rate,
fill = go_for_it_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Go-for-it rate, 4th-4 or less", y = "", x = "") +
hrbrthemes::theme_ft_rc()
df
pbp %>%
filter(posteam == 'ARI') %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type)
pbp %>%
filter(posteam == 'ARI', season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type)
pbp %>%
filter(posteam == 'ARI', season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
pbp %>%
filter(posteam == 'ARI', down == 4, ydstogo <= 4, season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
df
pbp %>%
filter(posteam == 'ARI', down == 4, ydstogo <= 4, season == 2001) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
pbp %>%
filter(posteam == 'ARI', down == 4, ydstogo <= 1, season == 2001) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
pbp %>%
filter(posteam == 'ARI', down == 4, ydstogo <= 1, season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
pbp %>%
filter(posteam == 'PHI', down == 4, ydstogo <= 1, season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
pbp %>%
filter(posteam == 'PHI', down == 4, ydstogo <= 2, season == 2020) %>% #, play_type == 'punt'
group_by(season) %>%
count(play_type) %>%
ungroup()
distinct(pbp, play_type_nfl)
pbp %>%
filter(down == 4, play_type %in% c("pass", "run", "punt", "field_goal")) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type_nfl %in% c("PASS", "RUSH", "PUNT", "FIELD_GOAL")) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type %in% c("pass", "run", "punt", "field_goal")) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type_nfl %in% c("PASS", "RUSH", "PUNT", "FIELD_GOAL")) %>%
count(play_type_nfl)
select(pbp, contains('play')) %>% names()
count(pbp, play)
pbp %>%
filter(down == 4, play_type %in% c("pass", "run", "punt", "field_goal"), play == 1) %>%
count(play_type)
pbp %>%
filter(down == 4, play_type_nfl %in% c("PASS", "RUSH", "PUNT", "FIELD_GOAL"), play == 1) %>%
count(play_type_nfl)
select(pbp, contains('game')) %>% names()
select(pbp, contains('team')) %>% names()
select(pbp, contains('q')) %>% names()
select(pbp, contains('penalty')) %>% names()
select(pbp, contains('play')) %>% names()
select(pbp, contains('down')) %>% names()
select(pbp, contains('dist')) %>% names()
select(pbp, contains('result')) %>% names()
count(pbp, result)
select(pbp, contains('special')) %>% names()
select(pbp, contains('st')) %>% names()
count(pbp, special_teams_play)
count(pbp, st_play_type)
select(pbp, contains('type')) %>% names()
select(pbp, contains('pen')) %>% names()
select(pbp, contains('result')) %>% names()
count(pbp, penalty)
count(pbp, penalty_type)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play),
n_chances = n()
)
#count(pbp, special)
select(pbp, contains('st')) %>% nmaes()
select(pbp, contains('st')) %>% names()
select(pbp, contains('special')) %>% names()
count(pbp, st_play_type)
pbp %>%
mutate(
scrimmage_play = st_play_type == "NULL",
scrimmage_play1 = st_play_type == NA) %>%
select(scrimmage_play, scrimmage_play1)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
mutate(scrimmage_play = st_play_type == NA) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play),
n_chances = n()
)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
mutate(scrimmage_play = st_play_type == NA)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
mutate(scrimmage_play = st_play_type == NA) %>% select(scrimmage_play)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
mutate(scrimmage_play = st_play_type == NA) %>% count(scrimmage_play)
pbp %>%
mutate(
scrimmage_play1 = play_type %in% c('run', 'pass'),
scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')
) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play),
n_chances = n())
pbp %>%
mutate(
scrimmage_play1 = play_type %in% c('run', 'pass'),
scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')
) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n())
fourth_down_rates1 <- pbp %>%
mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n()
)
fourth_down_rates1 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n()
)
fourth_down_rates1
fourth_down_rates1 <- pbp %>%
mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n()
)
fourth_down_rates2 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n()
)
fourth_down_rates1
fourth_down_rates2
fourth_down_rates1 %>%
arrange(-go_forit_rate) %>%
head()
fourth_down_rates2 %>%
arrange(-go_forit_rate) %>%
head()
fourth_down_rates1 <- pbp %>%
mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates2 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(posteam, season) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates2 %>%
arrange(-go_forit_rate) %>%
head()
fourth_down_rates1 %>%
arrange(-go_forit_rate) %>%
head()
fourth_down_rates1 %>%
arrange(-n_chances) %>%
head()
fourth_down_rates2 %>%
arrange(-n_chances) %>%
head()
select(pbp, contains('wp'))
select(pbp, contains('wp')) %>% names()
pbp %>%
group_by(season) %>%
summarise(
wp = sum(is.na(wp))
)
pbp %>%
group_by(season) %>%
summarise(
wp = sum(is.na(wp), na.rm = TRUE)
)
pbp %>%
group_by(season) %>%
summarise(
wp = sum(is.na(wp), na.rm = TRUE)
) %>%
View()
pbp %>%
filter(is.na(wp)) %>%
select(desc)
pbp %>%
filter(down == 4, ydstogo <= 5) %>%
group_by(season) %>%
summarise(
wp = sum(is.na(wp), na.rm = TRUE)
) %>%
View()
fourth_down_rates3 <- pbp %>%
mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5, between(wp, 20, 80)) %>%
group_by(posteam, season, ydstogo) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates4 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 5, between(wp, 20, 80)) %>%
group_by(posteam, season, ydstogo) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n(),
.groups = "drop"
)
pbp %>%
#mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5, between(wp, 20, 80))
pbp %>%
#mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, between(wp, 20, 80))
count(pbp, wp)
pbp %>%
ggplot(x = wp) + geom_histogram()
pbp %>%
ggplot(aes(x = wp)) + geom_histogram()
fourth_down_rates3 <- pbp %>%
mutate(scrimmage_play1 = play_type %in% c('run', 'pass')) %>%
filter(down == 4, ydstogo <= 5, between(wp, 0.20, 0.80)) %>%
group_by(posteam, season, ydstogo) %>%
summarise(
go_forit_rate = mean(scrimmage_play1),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates4 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 5, between(wp, 0.20, 0.80)) %>%
group_by(posteam, season, ydstogo) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates3
fourth_down_rates3 %>%
ggplot(aes(
x = season,
y = go_forit_rate,
fill = go_forit_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Go-for-it rate, 4th-4 or less",
subtitle = "WP Between 20% and 80%",
y = "", x = "") +
hrbrthemes::theme_ft_rc()
esquisse:::esquisser()
fourth_down_rates3 %>%
filter(go_forit_rate < 0.1) %>% View()
fourth_down_rates4 %>%
ggplot(aes(
x = season,
y = go_forit_rate,
fill = go_forit_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Go-for-it rate, 4th-5 or less",
subtitle = "WP Between 20% and 80%",
y = "", x = "") +
hrbrthemes::theme_ft_rc()
fourth_down_rates4 <- pbp %>%
mutate(scrimmage_play2 = play_type_nfl %in% c('RUSH', 'PASS')) %>%
filter(down == 4, ydstogo <= 4, between(wp, 0.20, 0.80)) %>%
group_by(posteam, season, ydstogo) %>%
summarise(
go_forit_rate = mean(scrimmage_play2),
n_chances = n(),
.groups = "drop"
)
fourth_down_rates4 %>%
ggplot(aes(
x = season,
y = go_forit_rate,
fill = go_forit_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Go-for-it rate, 4th-5 or less",
subtitle = "WP Between 20% and 80%",
y = "", x = "") +
hrbrthemes::theme_ft_rc()
esquisse:::esquisser()
fourth_down_rates4 %>%
ggplot(aes(
x = season,
y = go_forit_rate,
fill = go_forit_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Go-for-it rate, 4th-5 or less",
subtitle = "WP Between 20% and 80%",
y = "", x = "") +
hrbrthemes::theme_ft_rc() +
facet_wrap(vars(ydstogo))
df_wide_season %>%
ggplot(aes(
x = season,
y = go_for_it_rate,
fill = go_for_it_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Go-for-it rate, 4th-4 or less", y = "", x = "") +
hrbrthemes::theme_ft_rc()
df_wide_season %>%
ggplot(aes(
x = season,
y = go_for_it_rate,
fill = go_for_it_rate
)) +
geom_quasirandom(pch = 21, size = 3) +
scale_fill_viridis_c("",  guide = 'none', option = 'E') +
scale_x_continuous(labels = 2001:2021, breaks = 2001:2021) +
scale_y_continuous(labels = scales::percent) +
labs(title = "Go-for-it rate, 4th-4 or less", y = "", x = "") +
hrbrthemes::theme_ft_rc()
df_wide_season %>%
ggplot(aes(
x = forcats::fct_reorder(.f = posteam, .x = go_for_it_rate, .fun = mean),
fill = team_color2,
colour = team_color,
y = go_for_it_rate,
group = posteam
)) +
geom_bar(stat = "summary", fun = mean) +
#geom_text(aes(label = sum(n_chances)), stat = 'unique') +
coord_flip(ylim = c(0.22, 0.31)) +
#coord_flip(ylim = c(0.225, 0.325)) +
#scale_y_continuous(breaks = seq(0.225, 0.325, 0.025)) +
scale_y_continuous(n.breaks = 8) +
scale_color_identity(aesthetics = c('fill', 'colour')) +
hrbrthemes::theme_ft_rc(base_size = 9.5, axis_title_size = 11) +
labs(
y = 'Go For It Rate',
x = 'Team',
title = 'Go For it Rate',
subtitle = '2001 - 2021, Regular Season',
caption = '4th down and 4 yards or less. data: nflfastR'
)
df_wide_team %>%
ggplot(aes(
x = fct_reorder(posteam, go_for_it_rate),
y = go_for_it_rate,
fill = team_color,
colour = team_color2
)) +
geom_col() +
geom_text(aes(y = 0.2175, label = total_opportunities), stat = 'unique') +
geom_text(aes(label = round(go_for_it_rate, 3)), stat = 'unique', hjust = 1.15) +
coord_flip(ylim = c(0.22, 0.31)) +
scale_y_continuous(
n.breaks = 8,
labels = label_number(accuracy = 1, scale = 100, suffix = '%')
) +
scale_color_identity(aesthetics = c('fill', 'colour')) +
hrbrthemes::theme_ft_rc(base_size = 9.5, axis_title_size = 11) +
labs(
y = 'Go For It Rate',
x = 'Team',
title = 'Go For it Rate',
subtitle = '2001 - 2021, Regular Season',
caption = '4th down and 4 yards or less. data: nflfastR\n Number of the left is the n of chances.'
)
