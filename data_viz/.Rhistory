defenses %>%
filter(season < 2021) %>%
ggplot(aes(
x = season,
y = next_season_rank,
fill = next_season_rank
)) +
ggbeeswarm::geom_quasirandom(pch = 21, size = 7, width = 0.1) +
#viridis::scale_fill_viridis("", guide = FALSE) +
scale_fill_viridis_b("", guide = "none") +
tomtom::theme_538() +
geom_hline(yintercept = 5, linetype = "dashed") +
geom_hline(yintercept = 10, linetype = "dashed") +
labs(
title = "Where Top 5 Defense ranks the year after",
subtitle = "2011-2020, determined by EPA/Play",
x = "Season",
y = "Next Season Rank"
) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 4)) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10))
defenses %>%
filter(season < 2021) %>%
ggplot(aes(
x = season,
y = next_season_rank,
fill = next_season_rank
)) +
ggbeeswarm::geom_quasirandom(pch = 21, size = 7, width = 0.1) +
#viridis::scale_fill_viridis("", guide = FALSE) +
scale_fill_viridis_b("", guide = "none") +
tomtom::theme_538() +
geom_hline(yintercept = 5, linetype = "dashed") +
geom_hline(yintercept = 10, linetype = "dashed") +
labs(
title = "Where Top 5 Defense ranks the year after",
subtitle = "2011-2020, determined by EPA/Play",
x = "Season",
y = "Next Season Rank"
) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 8)) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10))
bad_defenses <- pbp %>%
filter(
!is.na(epa),
!is.na(defteam),
pass == 1 | rush == 1
) %>%
group_by(defteam, season) %>%
summarise(def_epa = mean(epa)) %>%
arrange(def_epa) %>%
group_by(season) %>%
mutate(season_rank = row_number()) %>%
ungroup() %>%
arrange(season) %>%
group_by(defteam) %>%
mutate(next_season_rank = lead(season_rank)) %>%
filter(season_rank > 27)
bad_defenses %>%
filter(season < 2021) %>%
ggplot(aes(
x = season,
y = next_season_rank,
fill = next_season_rank
)) +
geom_quasirandom(pch = 21, size = 7, width = 0.1) +
viridis::scale_fill_viridis("", guide = "none") +
theme_538() +
geom_hline(yintercept = 28, linetype = "dashed") +
geom_hline(yintercept = 16, linetype = "dashed") +
labs(title = "Where bottom 5 Defense ranks the year after",
subtitle = "2011-2021, determined by EPA/Play",
x = "Season", y = "Next Season Rank") +
scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10))
bad_defenses %>%
filter(season < 2021) %>%
ggplot(aes(
x = season,
y = next_season_rank,
fill = next_season_rank
)) +
geom_quasirandom(pch = 21, size = 7, width = 0.1) +
viridis::scale_fill_viridis("", guide = "none") +
tomtom::theme_538() +
geom_hline(yintercept = 28, linetype = "dashed") +
geom_hline(yintercept = 16, linetype = "dashed") +
labs(title = "Where bottom 5 Defense ranks the year after",
subtitle = "2011-2021, determined by EPA/Play",
x = "Season", y = "Next Season Rank") +
scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
scale_y_continuous(breaks = scales::pretty_breaks(n = 10))
library(tidyverse)
pbp <- purrr::map_df(c(2016:2021), function(x) {
readRDS(
glue::glue("~/Documents/nfl/data/pbp/play_by_play_{x}.rds")
)
}) %>%
filter(season_type == 'REG')
epa_play <- pbp %>%
filter(pass == 1, !is.na(posteam)) %>%
group_by(posteam) %>%
summarise(
n = n(),
epa_per_db = sum(epa, na.rm = TRUE) / n,
success_rate = sum(epa, na.rm = TRUE) / n
)
rush_v_pass <- pbp %>%
filter(play_type %in% c("run", "pass"), penalty == 0) %>%
group_by(play_type, posteam) %>%
summarize(avg_yds = mean(yards_gained, na.rm = TRUE)) %>%
ungroup()
nfl_rvp <- pbp %>%
filter(play_type %in% c("run", "pass"), penalty == 0) %>%
group_by(play_type) %>%
summarize(avg_yds = mean(yards_gained, na.rm = TRUE)) %>%
ungroup() %>%
mutate(posteam = "NFL")
rush_v_pass <- bind_rows(rush_v_pass, nfl_rvp) %>%
mutate(play_type = factor(play_type,
levels = c("pass", "run"),
labels = c("Pass", "Rush")))
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
#coord_flip()
geom_text(
data = filter(rush_v_pass, posteam == "NFL" & play_type == "Pass"),
aes(label = play_type),
hjust = 0, nudge_y = 0.2, fontface = "bold", size = 6
) +
geom_text(
data = filter(rush_v_pass, posteam == "NFL" & play_type == "Rush"),
aes(label = play_type),
hjust = 1, nudge_y = -0.2, fontface = "bold", size = 6
) +
coord_flip() +
scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(
x = "",
y = "\n Average Yards Gained",
title = "Passing yards per play outperforms Rushing for all teams",
caption = "Data: @nflfastR | Plot: @becausejustyn"
) +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, posteam == "NFL" & play_type == "Pass"),
aes(label = play_type),
hjust = 0, nudge_y = 0.2, fontface = "bold", size = 6
) +
geom_text(
data = filter(rush_v_pass, posteam == "NFL" & play_type == "Rush"),
aes(label = play_type),
hjust = 1, nudge_y = -1, fontface = "bold", size = 6
) +
coord_flip() +
scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(
x = "",
y = "\n Average Yards Gained",
title = "Passing yards per play outperforms Rushing for all teams",
caption = "Data: @nflfastR | Plot: @becausejustyn"
) +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
filter(rush_v_pass, posteam == "NFL" & play_type == "Rush")
rush_v_pass
filter(rush_v_pass, play_type == "Rush")
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, play_type == "Rush"),
aes(label = avg_yds, colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
coord_flip() +
scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(
x = "",
y = "\n Average Yards Gained",
title = "Passing yards per play outperforms Rushing for all teams",
caption = "Data: @nflfastR | Plot: @becausejustyn"
) +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, play_type == "Rush"),
aes(label = avg_yds, colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
geom_text(
data = filter(rush_v_pass, play_type == "Pass"),
aes(label = avg_yds, colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
coord_flip() +
scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(
x = "",
y = "\n Average Yards Gained",
title = "Passing yards per play outperforms Rushing for all teams",
caption = "Data: @nflfastR | Plot: @becausejustyn"
) +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, play_type == "Rush"),
aes(label = avg_yds, colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
geom_text(
data = filter(rush_v_pass, play_type == "Pass"),
aes(label = avg_yds, colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
coord_flip() +
#scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(
x = "",
y = "\n Average Yards Gained",
title = "Passing yards per play outperforms Rushing for all teams",
caption = "Data: @nflfastR | Plot: @becausejustyn"
) +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, play_type == "Rush"),
aes(label = round(avg_yds, 2), colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
geom_text(
data = filter(rush_v_pass, play_type == "Pass"),
aes(label = round(avg_yds, 2), colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
coord_flip() +
scale_color_manual(values = c("#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(x = "", y = "", title = "") +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
rush_v_pass %>%
ggplot(aes(
x = fct_rev(fct_reorder2(posteam, desc(play_type), avg_yds)),
y = avg_yds, color = play_type)) +
geom_line(aes(group = posteam), color = "grey", size = 3) +
geom_point(size = 5) +
geom_text(
data = filter(rush_v_pass, play_type == "Rush"),
aes(label = round(avg_yds, 2), colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
geom_text(
data = filter(rush_v_pass, play_type == "Pass"),
aes(label = round(avg_yds, 2), colour = "white"), hjust = 0, nudge_y = 0, fontface = "bold", size = 2
) +
coord_flip() +
scale_color_manual(values = c("grey", "#003399", "#ff2b4f")) +
tomtom::theme_538() +
theme(
panel.grid.major.y = element_blank(),
legend.position = "none",
axis.text.y = element_text(color = if_else(rush_v_pass$posteam == "NFL", "red", "black"))
) +
labs(x = "", y = "", title = "") +
scale_y_continuous(
limits = c(3, 9),
breaks = seq(3, 8, 1)
)
ggplot() +
theme_classic() +
theme(axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = discipline),
size = 0, col = "white")
rush_v_pass
library(dslabs)
success_rates <- rbind(
# male success rates
transmute(research_funding_rates,
discipline,
success = success_rates_men,
gender = "Male"),
# female success rates
transmute(research_funding_rates,
discipline,
success = success_rates_women,
gender = "Female"))
success_rates
research_funding_rates %>%
# rearrange the factor levels for discipline by rates for women
arrange(success_rates_women) %>%
mutate(discipline = fct_inorder(discipline)) %>%
ggplot() +
# remove axes and superfluous grids
theme_classic() +
theme(
axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()
) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = discipline), size = 0, col = "white") +
# add the horizontal discipline lines
geom_hline(yintercept = 1:9, col = "grey80") +
# add a point for each male success rate
geom_point(aes(x = success_rates_men, y = discipline), size = 11, col = "#9DBEBB") +
# add a point for each female success rate
geom_point(aes(x = success_rates_women, y = discipline), size = 11, col = "#468189")
research_funding_rates %>%
# rearrange the factor levels for discipline by rates for women
arrange(success_rates_women) %>%
mutate(discipline = fct_inorder(discipline))
research_funding_rates %>%
# rearrange the factor levels for discipline by rates for women
arrange(success_rates_women) %>%
mutate(discipline = fct_inorder(discipline)) %>% View()
research_funding_rates
research_funding_rates %>% View()
rush_v_pass
research_funding_rates
research_funding_rates %>% names()
dplyrAssist:::dplyrAssist()
rush_v_pass %>%
spread(play_type, avg_yds)
research_funding_rates
success_rates
rush_v_pass
rush_v_pass
research_funding_rates %>% View()
rush_v_pass_temp <- rush_v_pass %>%
spread(play_type, avg_yds)
rush_v_pass_temp %> View()
rush_v_pass_temp %>% View()
rush_v_pass_temp
rush_v_pass
this <- rbind(
transmute(rush_v_pass,
posteam,
avg_yds,
play_type = "Pass"),
# female success rates
transmute(rush_v_pass,
posteam,
avg_yds,
play_type = "Rush"))
)
this <- rbind(
transmute(rush_v_pass,
posteam,
avg_yds,
play_type = "Pass"),
# female success rates
transmute(rush_v_pass,
posteam,
avg_yds,
play_type = "Rush"))
this
this %>% View()
rush_v_pass %>%
# rearrange the factor levels for posteam by rates for women
arrange(avg_yds) %>%
mutate(posteam = fct_inorder(posteam)) %>%
ggplot() +
# remove axes and superfluous grids
theme_classic() +
theme(
axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()
) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = posteam), size = 0, col = "white") +
# add the horizontal posteam lines
geom_hline(yintercept = 1:32, col = "grey80") +
# add a point for each male success rate
geom_point(aes(x = filter(rush_v_pass, play_type == "Pass"), y = posteam), size = 11, col = "#9DBEBB") +
# add a point for each female success rate
geom_point(aes(x = filter(rush_v_pass, play_type == "Rush"), y = posteam), size = 11, col = "#468189")
rush_v_pass %>%
# rearrange the factor levels for posteam by rates for women
arrange(avg_yds) %>%
mutate(posteam = fct_inorder(posteam)) %>%
ggplot() +
# remove axes and superfluous grids
theme_classic() +
theme(
axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()
) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = posteam), size = 0, col = "white") +
# add the horizontal posteam lines
geom_hline(yintercept = 1:32, col = "grey80") +
# add a point for each male success rate
geom_point(aes(x = filter(play_type == "Pass"), y = posteam), size = 11, col = "#9DBEBB") +
# add a point for each female success rate
geom_point(aes(x = filter(play_type == "Rush"), y = posteam), size = 11, col = "#468189")
rush_v_pass %>%
# rearrange the factor levels for posteam by rates for women
arrange(avg_yds) %>%
mutate(posteam = fct_inorder(posteam)) %>%
ggplot() +
# remove axes and superfluous grids
theme_classic() +
theme(
axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()
) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = posteam), size = 0, col = "white") +
# add the horizontal posteam lines
geom_hline(yintercept = 1:32, col = "grey80") +
# add a point for each male success rate
geom_point(data = rush_v_pass, aes(x = filter(play_type == "Pass"), y = posteam), size = 11, col = "#9DBEBB") +
# add a point for each female success rate
geom_point(data = rush_v_pass, aes(x = filter(play_type == "Rush"), y = posteam), size = 11, col = "#468189")
rush_v_pass %>%
# rearrange the factor levels for posteam by rates for women
arrange(avg_yds) %>%
mutate(posteam = fct_inorder(posteam)) %>%
ggplot() +
# remove axes and superfluous grids
theme_classic() +
theme(
axis.title = element_blank(),
axis.ticks.y = element_blank(),
axis.line = element_blank()
) +
# add a dummy point for scaling purposes
geom_point(aes(x = 12, y = posteam), size = 0, col = "white") +
# add the horizontal posteam lines
geom_hline(yintercept = 1:32, col = "grey80") +
# add a point for each male success rate
geom_point(data = rush_v_pass, aes(x = filter(play_type == "Pass")), size = 11, col = "#9DBEBB") +
# add a point for each female success rate
geom_point(data = rush_v_pass, aes(x = filter(play_type == "Rush")), size = 11, col = "#468189")
